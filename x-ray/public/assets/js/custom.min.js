$.validator.setDefaults({
	highlight:function(element){$(element).closest('.form-group').addClass('has-error');
    },
    unhighlight:function(element){$(element).closest('.form-group').removeClass('has-error');
    },
	submitHandler: function(form) {
        $(".preloader").fadeIn();
        form.submit();
    },
    errorElement:'span',
    errorClass:'help-block',
    errorPlacement: function(error, element){ 
        if(element.parent('.input-group').length){
            error.insertAfter(element.parent());
        }else if(element.attr("id")=="page_desc"){
			error.appendTo($('#page_desc').parent('div'));
		}else if(element.attr("id")=="temp_text"){
			error.appendTo($('#temp_text').parent('div'));
		}else{
            error.insertAfter(element);
        }
}});
jQuery.validator.addClassRules("validateEmail",{
	remote:{url:ADMIN_APPURL+"/validate-details/email"}
});

$.validator.addMethod("custom_price", function(value, element) {
    return this.optional(element) ||
        value.match(/^([0-9])+\.([0-9])+$/)
   ||
        value.match(/^([0-9])+$/);
}, "Please enter a valid price");


jQuery.validator.addClassRules("validateUsername",{
	remote:{url:ADMIN_APPURL+"/validate-details/username"}
});
$.validator.addMethod("pwd_username_not_same", function(value, element) {
   return $('#admin_nickname').val() != $('#admin_password').val()
}, PwdUserError);


$.validator.addMethod("regex",function(value, element, regexp) {
	       var re = new RegExp(regexp);
		   
            return this.optional(element) || re.test(value);
        },
        "Password must contain atleast one lower case,one upper case, one digit and one special character and at least 8 characters."
);

jQuery.validator.addClassRules({pswZXRhYmVlYgrd : {regex: /(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*()_=\[\]{};':"\\|,.<>\/?+-]).{8,}/}});
$('#common-form').validate({
	rules:{
		cp_credits:{maxlength:5},
		ap_credits:{maxlength:5},
		cp_price:{max:5000},	
	}
	});
$('#resetForm').validate({
	rules:{
		admin_rpassword:{equalTo:'#admin_password'}	
	}
});

$(document).ready(function() {



	
		 $(".preloader").fadeOut();
		if(Action!="login"){
   			$("#side-menu").metisMenu()
      		$(".right-side-toggle").click(function(){
            $(".right-sidebar").slideDown(50), $(".right-sidebar").toggleClass("shw-rside"), $(".fxhdr").click(function() {
                $("body").toggleClass("fix-header")
            }), $(".fxsdr").click(function() {
                $("body").toggleClass("fix-sidebar")
            }), $("body").hasClass("fix-header") ? $(".fxhdr").attr("checked", !0) : $(".fxhdr").attr("checked", !1), $("body").hasClass("fix-sidebar") ? $(".fxsdr").attr("checked", !0) : $(".fxsdr").attr("checked", !1)
        }),
		
			$(function() {
				$(window).bind("load resize", function(){
					topOffset = 60, width = this.window.innerWidth > 0 ? this.window.innerWidth : this.screen.width, width < 768 ? ($("div.navbar-collapse").addClass("collapse"), topOffset = 100) : $("div.navbar-collapse").removeClass("collapse"), height = (this.window.innerHeight > 0 ? this.window.innerHeight : this.screen.height) - 1, height -= topOffset, height < 1 && (height = 1), height > topOffset && $("#page-wrapper").css("min-height", height + "px")
				});
			}), 
		
			$(function(){
            $(window).bind("load resize", function() {
                width = this.window.innerWidth > 0 ? this.window.innerWidth : this.screen.width, width < 1170 ? ($("body").addClass("content-wrapper"), $(".open-close i").removeClass("icon-arrow-left-circle"), $(".sidebar-nav, .slimScrollDiv").css("overflow-x", "visible").parent().css("overflow", "visible"), $(".logo span").hide()) : ($("body").removeClass("content-wrapper"), $(".open-close i").addClass("icon-arrow-left-circle"), $(".logo span").show())
            })
        }), 
		
			$(".open-close").on("click", function() {
            $("body").hasClass("content-wrapper") ? ($("body").trigger("resize"), $(".sidebar-nav, .slimScrollDiv").css("overflow", "hidden").parent().css("overflow", "visible"), $("body").removeClass("content-wrapper"), $(".open-close i").addClass("icon-arrow-left-circle"), $(".logo span").show()) : ($("body").trigger("resize"), $(".sidebar-nav, .slimScrollDiv").css("overflow-x", "visible").parent().css("overflow", "visible"), $("body").addClass("content-wrapper"), $(".open-close i").removeClass("icon-arrow-left-circle"), $(".logo span").hide())
        }),
		
       		$('[data-toggle="tooltip"]').tooltip();
			
			if($(".deimg").length>0){
				$('.deimg').initial(); 
			}
			
			$('.slimscrollsidebar').slimScroll({height: '100%',position:'right',size:"0px",color:'#dcdcdc'});
       
       		$('[data-toggle="popover"]').popover();
			Mousetrap.bind('ctrl+l',function(e){
				window.location=ADMIN_APPURL+'/lock-screen';
			});
			
			/*if(LoggedUser){
				idle({onIdle:function(){
					window.location=ADMIN_APPURL+'/lock-screen';
				},
				idle:1800000,
				keepTracking: true}).start();
			}*/
			
	   		$("body").trigger("resize"), $(".visited li a").click(function(e) {
    $(".visited li").removeClass("active");
    var i = $(this).parent();
    i.hasClass("active") || i.addClass("active"), e.preventDefault()}),
	   		
			$(".navbar-toggle").click(function(){$(".navbar-toggle i").toggleClass("ti-menu"), $(".navbar-toggle i").addClass("ti-close")});
		}
		else{
			$('#loginform').validate();
			if($('#admin_password').length>0){
				$('#admin_password').password();
			}
			getCookie('');
		}
});


function setCookie(){
	if($('#checkbox-signup').prop('checked')){ 
		var username=$('#admin_email').val();
		var password=$('#admin_password').val();
		// set cookies to expire in 14 days
		Cookies.set('serviceio_username',username,{expires:14});
		Cookies.set('serviceio_password',password,{ expires:14});
		Cookies.set('serviceio_remember',true,{expires:14});
		} else {
		// reset cookies
		Cookies.set('serviceio_username', null);
		Cookies.set('serviceio_password', null);
		Cookies.set('serviceio_remember', null);
	}
}
function getCookie(page){
	var remember=Cookies.get('serviceio_remember');
	if(remember){
		var username=Cookies.get('serviceio_username');
		var password=Cookies.get('serviceio_password');
		$('#checkbox-signup').prop("checked",true);
		$('#admin_email').val(username);
		$('#admin_password').val(password);
		if(page=="repwd"){
			$('#password').val(password);
		}
	}
}
function avatarUploader(){
	$('.file-upload').fileupload({
		url:ADMIN_APPURL+'/upload',
		add:function(e, data) {  
			var uploadErrors=[];
			var file_name=data.originalFiles[0]['name']
	        var Extension=file_name.substr((file_name.lastIndexOf('.') + 1));
			var extension_array=['jpg','jpeg','png','JPG','JPEG','PNG'];
			if(($.inArray(Extension, extension_array)<0)){ 
				$('.fileinput-filename').html('');
				$('.fileinput').removeClass('fileinput-exists');
				$('.fileinput').addClass('fileinput-new');
				showAppAlert(SITENAME,extError,"warning");
			}
			else {
				data.submit();
			}
        },
		done: function(e,data){
			$('.fileinput-filename').html('');
			$('.fileinput').removeClass('fileinput-exists');
			$('.fileinput').addClass('fileinput-new');
			if(data.result==0){
				$('#pic-progress').hide();
				showAppAlert(SITENAME,extError,"warning");
			}
			else{
				var data=JSON.parse(data.result);
				if($('.user-content img').length>0){
					$('.user-content img').remove();
				}if($('.user-pro img').length>0){
					$('.user-pro img').remove();
				}if($('.user-bg img').length>0){
					$('.user-bg img').remove();
				}
				var bigImgTag="<img src='"+AVTBIGURL+"/"+data+"' style='width:100%;' alt='big-avatar' />"
				var imgTag="<img src='"+AVTURL+"/"+data+"' class='thumb-lg img-circle' alt='avatar' />";
				var smallimgTag="<img src='"+AVTURL+"/"+data+"' class='img-circle' alt='avatar' />";
				$('.user-content').html(imgTag);
				$('a#profile-avatar-link').prepend(smallimgTag);
				$('.user-bg').prepend(bigImgTag);
				$('#pic-progress').hide();
				toastInit(AvtUpdated,"success");
			}
		},
		progress: function(e, data){
			$('#pic-progress').show();
			var progress = parseInt(data.loaded / data.total * 100, 10);
			$("#pic-bar").width(progress+'%');
			$('#pic-progress').css('width', progress+'%');
		}
	});}

function mediaUploader(url){
	$('.file-upload').fileupload({
		url:ADMIN_APPURL+'/'+url,
		add:function(e, data) {  
			var uploadErrors=[];
			var file_name=data.originalFiles[0]['name']
	        var Extension=file_name.substr((file_name.lastIndexOf('.') + 1));
			var extension_array=['jpg','jpeg','png','JPG','JPEG','PNG'];
			if(($.inArray(Extension, extension_array)<0)){ 
				$('.fileinput-filename').html('');
				$('.fileinput').removeClass('fileinput-exists');
				$('.fileinput').addClass('fileinput-new');
				showAppAlert(SITENAME,extError,"warning");
			}
			else {
				data.submit();
			}
        },
		done: function(e,data){
			$('.fileinput-filename').html('');
			$('.fileinput').removeClass('fileinput-exists');
			$('.fileinput').addClass('fileinput-new');
			if(data.result==0){
				$('#pic-progress').hide();
				showAppAlert(SITENAME,extError,"warning");
			}
			else{
				var res=$.parseJSON(data.result);
				console.log(res.uploader);
				$('#page_images').val(res.uploader);
				if($('#preview').length>0){
					$('#preview').remove();
				}
				var img="<img id='preview' src='"+MEDIAURL+"/"+res.uploader+"'  alt='page-media' class='img-thumbnail' style='max-width:100px;' />";
				$(img).insertAfter($('#pic-progress'));
				toastInit(AvtUpdated,"success");
			}
		},
		progress: function(e, data){
			$('#pic-progress').show();
			var progress = parseInt(data.loaded / data.total * 100, 10);
			$("#pic-bar").width(progress+'%');
			$('#pic-progress').css('width', progress+'%');
		}
	});
}
$('#deletebcchk').click(function(e){
	var current_checked_status = $(this).prop('checked');
	if(current_checked_status==false){
		 $('.checkboxes').prop('checked',false);
	}
	else{
		$('.checkboxes').prop('checked',true);
	}
});	
function showAppAlert(title,msg,type){
	swal({   
		title:title,   
		text:msg,   
		type:type,
		timer:3000,   
		showConfirmButton:false 
	});
}
function showAppConfirmation(text){
	swal({   
		title:ConfirmTitle,   
		text:text,   
		type:"warning",   
		showCancelButton:true,   
		confirmButtonColor:"#DD6B55",   
		confirmButtonText:ConfirmBtn,
		cancelButtonText:CancelBtn,     
		closeOnConfirm:false,   
		closeOnCancel:false 
	},function(isConfirm){   
		if(isConfirm) {     
			swal("Deleted!", "Your imaginary file has been deleted.", "success");   
		} else {     
			swal("Cancelled", "Your imaginary file is safe :)", "error");   
		} 
	});
}
function toastInit(msg,icon){
	$.toast({
		heading:msg,
		position:'top-right',
		loaderBg:'#ff6849',
		icon:icon,
		hideAfter:3000, 
		allowToastClose:false,
		loader:false,
  	});
}
function checkPwdStrenth(val){
     var strongRegex = new RegExp("^(?=.{8,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\\W).*$", "g");
     var mediumRegex = new RegExp("^(?=.{7,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$", "g");
     var enoughRegex = new RegExp("(?=.{6,}).*", "g");
     if (false==enoughRegex.test(val)) {
         $('#passstrength').html('More Characters');
     } else if (strongRegex.test(val)) {
		 $('#passstrength').addClass('text-success');
		 $('#passstrength').html('Strong!');
     } else if (mediumRegex.test(val)) {
		 $('#passstrength').addClass('text-warning');
		 $('#passstrength').html('Medium!');
     } else {
		 $('#passstrength').addClass('text-danger');
		 $('#passstrength').html('Weak!');
     }
     return true;
}
function addFaq(id){
	 $.ajax({
		url:ADMIN_APPURL+'/get-faq-form',
		method:'post',
		data:{id:id},
		success:function(data){ 
			var splittedData=data.split('~~');
			$('#admin-webapp-modal .modal-title').html(splittedData[0]);
			$('#admin-webapp-modal .modal-body').html(splittedData[1]);
			$('#admin-webapp-modal .modal-body').append("<div class='clearfix'>&nbsp;</div>");
			$('#admin-webapp-modal .modal-body #faq-form').validate();
			$('#admin-webapp-modal').modal({backdrop:'static',keyboard:false});
		}
 	});
}
function checkSelects(id){
	//alert(id);
	var checkedRecords = false;
	$(".elem_ids").each(function(index, element) {
		if ($(this).prop("checked") == true) {
			checkedRecords = true;
		}
	});
	if (checkedRecords == false) {
		showAppAlert("X-Ray India", "No Records Selected for Delete,Please Select Records to delete", "warning");
		return false;
	}
	else{
		swal({
		title: "Are you sure?",
		text: "Do you want to delete ?",
		type: "warning",
		showCancelButton: true,
		confirmButtonColor: "#DD6B55",
		confirmButtonText: "Confirm",
		cancelButtonText: "Cancel",
		closeOnConfirm: true,
		closeOnCancel: true
		}, function(isConfirm) {
		if(isConfirm == true) {
			document.getElementById(id).submit();
		}
		else {
			return false;
		}
		});
	}
	
	return false;
}

function globalStatus(chkAll){
	if($(chkAll).hasClass("status-1")){
		var status=0
		$(chkAll).addClass("status-0");
		$(chkAll).removeClass("status-1");
	}
	else{
		var status=1
		$(chkAll).addClass("status-1");
		$(chkAll).removeClass("status-0");
	}
	vars = $(chkAll).attr("id").split("-");
	title =	$(chkAll).attr("title") ;
	fieldstatus = $(chkAll).attr("name");
	scriptUrl = ADMIN_APPURL+"/change-status/"+vars[0]+"/"+vars[1]+"/"+status+"/"+fieldstatus;
	if(title!==undefined && title!=""){usermessage=title+" has been changed";}
	else{
		field_title = vars[0].replace(/_/g," ");
		field_title=field_title;
		usermessage='<b>'+field_title +'</b>  status has been changed';
	}
	$.ajax({
		url: scriptUrl,
		dataType:"json",
		success: function(data){
			if(data.success){
				toastInit(data.message,'success');	
			}
			else{
				toastInit(data.message,'warning');
			}
		},
		error:function(data) {
			toastInit("<b>Internal Server Error</b>",'warning');
		}
	});
}
$(".pricebox").keydown(function(e){
		// Allow: backspace, delete, tab, escape, enter and .
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
             // Allow: Ctrl+A, Command+A
            (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) || 
             // Allow: home, end, left, right, down, up
            (e.keyCode >= 35 && e.keyCode <= 40)) {
                 // let it happen, don't do anything
                 return;
        }
        // Ensure that it is a number and stop the keypress
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
            e.preventDefault();
        }
});

function checkPselected(){
	if($('.portfolios input[type="checkbox"]:checked').length < 1){
		$('.portfolioErrorMsg').show();
	}
	else{
		$('.portfolioErrorMsg').hide();
		$('#common-form').submit();
	}
}

function getsubcategories(category){
	if(category!='0'){
		$(".preloader").fadeIn();
		$.ajax({
		url:ADMIN_APPURL+'/getsubcat/'+category,
		aysnc:false,
		success:function(data){
			$(".preloader").fadeOut();
			data = JSON.parse(data);
			if(data[0].length>0){
				$("#portfolio_subcategory").html('');
				$("#portfolio_subcategory").append('<option value="">Select Sub Category</option>');
				for(var i=0;i<data[0].length;i++){
					var selcted="";
					$("#portfolio_subcategory").append('<option value="'+data[0][i].sub_cat_id+'" '+selcted+' >'+data[0][i].sub_cat_title+'</option>');
				}
			} else {
				$("#portfolio_subcategory").html('');
				$("#portfolio_subcategory").append('<option value="">Select Sub Category</option>');
			}
		}
	});
	}
	else{
		$("#portfolio_subcategory").html('');
		$("#portfolio_subcategory").append('<option value="">Select Sub Category</option>');
	}
}



function deleteMedia1(){ /* to delete saved media*/
	var Total = parseInt($('#total_media_images').val());
	if(Total > 0){
		Total = Total - 1;
	}
	$('#total_media_images').val(Total);
}

function MediaFormSubmit(){
	var success=0;
	if($('.fileuploadForm').valid()){
		success='1';	
	}
	var checkImages=$('#total_media_images').val();
	if(checkImages>'0'){
		success='1';	
	}else{
		success='0';
		$('.errorMediaDiv').css('display','block');	
	}
	
	if(success=='1'){
		$('.fileuploadForm').submit();
	}
}
function MediaFormSubmit1(){
	var success=0;
	if($('.fileuploadForm').valid()){
		success='1';	
	}
	
	if(success=='1'){
		$('.fileuploadForm').submit();
	}
}

function deleteClinicMedia(Id){/* to check count of total media*/
	var Value = $('#deleteMedia').val();
	
	if(Value == ''){
		Value = Id ;
	}
	else{
		Value = Value+','+Id;
	}
	$('#deleteMedia').val(Value);
	$('#clinicMedia_'+Id).fadeOut();
	window.setTimeout(function(e){$('#clinicMedia_'+Id).remove();},2000);
	deleteMedia1();
}

